function tagrs_showForm(){_ge("tagadderlink").style.display="none";_ge("tagadder").style.display="block";_ge("addtagbox").focus();tagrs_startAutoComplete();}function tagrs_startAutoComplete(){if(_ge("tagSuggestions")){new TagCompleteWidget(_ge("addtagbox"),_ge("tagSuggestions"),global_nsid).completer.startLoading();}tagrs_startAutoComplete=function(){};}function tagrs_hideForm(){tagrs_clearForm();_ge("tagadderlink").style.display="block";_ge("tagadder").style.display="none";}function tagrs_clearForm(){document.forms.tagadderform.tag.value="";}function tagrs_addTag(_1,_2){if(!_ok_for_scrumjax_xml()){return true;}if(_2==""){return false;}deja_view_uh_huh();tagrs_clearForm();var _3=_ge("tagadder");_3.flickr_photos_addTags_onLoad=function(_4,_5,_6){if(_4){F.API.callMethod("flickr.photos.getInfo",{photo_id:_1},this);}else{var _7="Tag not added!";var _8=_5.documentElement.getElementsByTagName("err");if(_8&&_8[0].getAttribute("msg")){_7+=" "+_8[0].getAttribute("msg");}alert(_7);}};F.API.callMethod("flickr.photos.addTags",{photo_id:_1,tags:_2},_3);return false;}function tagrs_rebuildTagsHTML(_9,_10,tag,_12,_13){var _14="<div id=\"tagdiv"+_10+"\"><a class=\"globe\" onMouseOver=\"this.childNodes[0].src='/images/icon_globe_over.gif';\" onMouseOut=\"this.childNodes[0].src='/images/icon_globe.gif';\" href=\"/photos/tags/"+tag+"/\" title=\"Click this icon to see all public photos tagged with "+tag+"\"><img src=\"/images/icon_globe.gif\" width=\"16\" height=\"16\" class=\"icon\" alt=\"Click this icon to see all public photos tagged with "+tag+"\" /></a> <a class=\"Plain\" href=\""+global_photos[_9].ownersUrl+"tags/"+tag+"/\">"+_12.escape_for_display()+"</a>";if(_13){_14+="\r\n\t\t\t\t\t\t"+"&nbsp;<a href=\""+global_photos[_9].url+"?deletetag="+_10+"\" title=\"Delete this tag?\" class=\"Grey\" onclick=\"return tagrs_removeTag('"+_9+"', '"+_10+"', '"+tag+"', '"+_12.escape_for_display()+"')\">[x]</a>";}_14+="</div>";return _14;tagrs_setPopularUsed(tag);}function tagrs_removeTag(id,_16,tag,_17){if(window.confirm("Are you sure you want to delete the tag \""+_17.escape_for_display()+"\"?")){deja_view_uh_huh();if(!_ok_for_scrumjax_xml()){return true;}var _18=_ge("tagadder");_18.flickr_photos_removeTag_onLoad=function(_19,_20,_21){if(_19){tagrs_removedTag(id,_16,tag);}else{var txt="Tag not deleted!";var err=_20.documentElement.getElementsByTagName("err");if(err&&err[0].getAttribute("msg")){txt+=" "+err[0].getAttribute("msg");}alert(txt);}};F.API.callMethod("flickr.photos.removeTag",{tag_id:_16},_18);return false;}else{return false;}}function tagrs_removedTag(id,_24,tag){_ge("tagdiv"+_24).style.display="none";tagrs_setPopularUnUsedIfNotInInput(tag);var _25=tagrs_whereIsThisTagInHere(global_photos[id].tagsA,tag);for(var r=0;r<_25.length;r++){global_photos[id].tagsA.splice(_25[r],1);global_photos[id].tags_rawA.splice(_25[r],1);}}function tagrs_clearTags(){_ge("thetags").innerHTML="";}function tagrs_updatePopularList(_27){if(!_ok_for_scrumjax_xml()){return false;}var _28=_ge("addtagbox");var _29=tagrs_getTagsInInput(_28);var _30=(global_photos[_27]&&global_photos[_27].tagsA)?global_photos[_27].tagsA:[];var _31=(global_photos[_27]&&global_photos[_27].tags_rawA)?global_photos[_27].tags_rawA:[];for(var t=0;t<tagrs_popularA.length;t++){var tag=tagrs_popularA[t];var _33=tagrs_whereIsThisTagInHere(_30,tag);var _34=tagrs_whereIsThisTagInHere(_31,tag);var _35=tagrs_whereIsThisTagInHere(_29,tag);if(_33.length==0&&_34.length==0&&_35.length==0){tagrs_setPopularUnUsed(tag);}else{tagrs_setPopularUsed(tag);}}setTimeout("tagrs_updatePopularList('"+_27+"')",200);}tagrs_popularA=[];function tagrs_showPopular(_36,_37){if(!_ok_for_scrumjax_xml()){return false;}var _38=_ge("addtagbox");var _39=tagrs_getTagsInInput(_38);_36=(_36==undefined)?20:_36;var div=_ge("tagpopular");global_nsid;div.innerHTML="<i>loading...</i>";div.flickr_tags_getListUserPopular_onLoad=function(_41,_42,_43){if(_41){tagrs_popularA=[];var _44=_42.documentElement.getElementsByTagName("tag");if(_44.length==0){var _45="You have no tags yet.";}else{var _45="click a tag:";for(var t=0;t<_44.length;t++){var _46=_44[t];var tag=_46.firstChild.nodeValue;tagrs_popularA.push(tag);_45+=" <a href=\"#\" id=\"popTags"+tag+"\" onclick=\"tagrs_toggleTagInInput('"+tag+"', '"+_37+"'); return false;\">"+tag+"</a>";}if(_44.length>_36){_45+="<br><br><a href=\"#\" onclick=\"tagrs_showPopular("+(_36+20)+", '"+_37+"');return false;\">get more of your tags</a> | <a href=\"#\" onclick=\"tagrs_showPopular("+(_36+2000)+", '"+_37+"');return false;\">get all of your tags</a>";}}this.innerHTML=_45;tagrs_updatePopularList(_37);}else{var txt="Tags not loaded!";var err=_42.documentElement.getElementsByTagName("err");if(err&&err[0].getAttribute("msg")){txt+=" "+err[0].getAttribute("msg");}alert(txt);}};F.API.callMethod("flickr.tags.getListUserPopular",{count:_36+1},div);}function tagrs_setPopularUsed(tag){var _47=_ge("popTags"+tag);if(!_47){return;}_47.className="tagrsUsed";}function tagrs_setPopularUnUsed(tag){var _48=_ge("popTags"+tag);if(!_48){return;}_48.className="tagrsUnUsed";}function tagrs_setPopularUnUsedIfNotInInput(tag){var _49=_ge("popTags"+tag);if(!_49){return;}var _50=_ge("addtagbox");var _51=tagrs_getTagsInInput(_50);var _52=tagrs_whereIsThisTagInHere(_51,tag);if(_52.length>0){return;}tagrs_setPopularUnUsed(tag);}function tagrs_getTagsInInput(_53){var _54=_53.value.trim();if(_54==""){return [];}var _55=_54.split("\"");var _56=[];for(var i=0;i<_55.length;i++){var bit=_55[i].trim();if(i%2==0){var _59=bit.split(" ");for(var k=0;k<_59.length;k++){if(_59[k]!=""){_56.push(_59[k]);}}}else{if(bit!=""){_56.push(bit);}}}return _56;}function tagrs_toggleTagInInput(_61,_62){var _63=(global_photos[_62]&&global_photos[_62].tagsA)?global_photos[_62].tagsA:[];var _64=_ge("addtagbox");var _65=tagrs_getTagsInInput(_64);var _66=tagrs_whereIsThisTagInHere(_65,_61);if(_66.length==0){if(tagrs_whereIsThisTagInHere(_63,_61).length==0){_65.unshift(_61);}tagrs_setPopularUsed(_61);}else{for(var r=0;r<_66.length;r++){_65.splice(_66[r],1);}tagrs_setPopularUnUsed(_61);}var _67=_ge("popTags"+_61);if(_67){_67.blur();}var _68="";for(var t=0;t<_65.length;t++){_68+=(_65[t].indexOf(" ")==-1)?_65[t]:"\""+_65[t]+"\"";if(t+1<_65.length){_68+=" ";}}_64.value=_68;}function tagrs_whereIsThisTagInHere(_69,_70){var A=[];for(var t=0;t<_69.length;t++){var tag=_69[t];if(_70.toLowerCase()==tag.replace(" ","").toLowerCase()){A.unshift(t);}}return A;}function tagrs_writePopularLink(_72){if(!_ok_for_scrumjax_xml()){return;}document.write("<div style=\"margin-top:5px; font-size:12px\" id=\"tagpopular\"><a style=\"text-decoration: none;\" href=\"#\" onclick=\"tagrs_showPopular(20, '"+_72+"');return false;\">Choose from your tags</a></div>");var _73=_ge("tagadder");if(_73){_73.flickr_photos_getInfo_onLoad=function(_74,_75,_76){if(_74){var _77=_75.documentElement.getElementsByTagName("tag");_rebuild_tags_for_photos(_72,_77);var _78=global_photos[_72];var _79="";for(var t=0;t<_78.tagsA.length;t++){_79+=tagrs_rebuildTagsHTML(_72,_78.tags_idA[t],_78.tagsA[t],_78.tags_rawA[t],_78.tags_canDeleteA[t]);}_79+="<br>";var div=_ge("thetags");div.innerHTML=_79;}else{alert("info not got");}};}if(window.deja_view_should_refresh){_ge("thetags").innerHTML="...<br>";}}
