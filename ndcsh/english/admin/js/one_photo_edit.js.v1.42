F._one_photo_tab=new Object();F._one_photo_tab.tab_go_go_go=function(_1){if(_1){this.style.cursor="default";_ge("one_photo_edit_pop").pop_activate_tab(this.id);}else{this.style.cursor=(document.all)?"hand":"pointer";}};F._one_photo_tab.tab_activate=function(){this.className="one_photo_tab_active";this.style.cursor="default";};F._one_photo_tab.tab_deactivate=function(){this.className="one_photo_tab";this.style.cursor=(document.all)?"hand":"pointer";};F._one_photo_tab.onclick=function(e){var _3=_get_event_src(e);if(!e){e=window.event;}if(_3!=this){return;}_ge("one_photo_edit_pop").pop_activate_tab(this.id);};F._one_photo_edit_pop=new Object();F._one_photo_edit_pop.pop_go_go_go=function(_4){F.decorate(this,F._eb).eb_go_go_go();this.pop_show_loc_els=_4;this.style.position="absolute";this.style.zIndex="995";this.style.top="0";this.style.left="0";this.style.display="none";this.pop_shadow_id=F.make_shadow(this.id,994).id;this.pop_showing=0;this.pop_loading=1;this.pop_fragment_loaded=0;var _5=document.createElement("DIV");_5.id="one_photo_modal_blocker";_5.style.position="absolute";_5.style.zIndex="993";_5.style.top=0;_5.style.backgroundColor="#999";_5.style.opacity=".5";_5.style.filter="alpha(opacity=50)";_5.style.display="none";document.body.appendChild(_5);F.eb_add(this);return this;};F._one_photo_edit_pop.pop_get_mb=function(){return _ge("one_photo_modal_blocker");};F._one_photo_edit_pop.pop_get_active_tab_id=function(){return this.pop_active_tab_id;};F._one_photo_edit_pop.pop_get_mat_id_from_tab_id=function(_6){return _6.replace("_tab_","_mat_");};F._one_photo_edit_pop.pop_activate_tab=function(_7){if(this.pop_get_active_tab_id()!=_7){if(this.pop_get_active_tab_id()){this.pop_deactivate_tab(this.pop_get_active_tab_id());}_ge(_7).tab_activate();var _8=this.pop_get_mat_id_from_tab_id(_7);_ge(_8).style.display="block";this.pop_active_tab_id=_7;this.pop_place();this.pop_do_focus();}};F._one_photo_edit_pop.pop_close_license_pop=function(){l_pop=_ge("one_photo_license_pop");l_pop.style.display="none";if(this.pop_license_pop_shadow_id){_ge(this.pop_license_pop_shadow_id).shadow_hide();}};F._one_photo_edit_pop.pop_license_was_switched=function(){this.pop_close_license_pop();this.pop_change_license_name();};F._one_photo_edit_pop.pop_open_license_pop=function(){l_pop=_ge("one_photo_license_pop");if(!this.pop_license_pop_shadow_id){this.pop_license_pop_shadow_id=F.make_shadow("one_photo_license_pop",2,this,l_pop).id;}l_pop.style.display="block";l_pop.style.visibility="hidden";var x=_pi((this.offsetWidth-l_pop.offsetWidth)/2);var y=_pi((this.offsetHeight-l_pop.offsetHeight)/2);l_pop.style.left=x+"px";l_pop.style.top=y+"px";l_pop.style.visibility="visible";_ge(this.pop_license_pop_shadow_id).shadow_size_and_place();if(!document.all){_ge(this.pop_license_pop_shadow_id).shadow_show();}};F._one_photo_edit_pop.pop_toggle_more_perms_table=function(){var _11=_ge("one_photo_more_perms_table");var _12=_ge("one_photo_more_perm_carrot_div");if(_11.style.display!="none"){_11.style.display="none";_12.style.display="block";}else{_11.style.display="block";_12.style.display="none";}this.pop_place();};F._one_photo_edit_pop.pop_deactivate_tab=function(_13){if(!_ge(_13)){return;}_ge(_13).tab_deactivate();var _14=this.pop_get_mat_id_from_tab_id(_13);_ge(_14).style.display="none";};F._one_photo_edit_pop.fragment_onLoad=function(_15,_16,_17){this.innerHTML=_16;this.pop_fragment_loaded=1;var _18=document.getElementsByClass("one_photo_tab","div");for(var i=0;i<_18.length;i++){F.decorate(_18[i],F._one_photo_tab).tab_go_go_go();}var _18=document.getElementsByClass("one_photo_tab_active","div");for(var i=0;i<_18.length;i++){this.pop_active_tab_id=_18[i].id;F.decorate(_18[i],F._one_photo_tab).tab_go_go_go(1);}F.decorate(_ge("one_photo_more_perm_carrot_div"),F._carrot).carrot_go_go_go("down",0);if(!this.pop_show_loc_els){_ge("one_photo_geo_data_div").style.display="none";}this.pop_stop_comming();if(this.pop_photo){this.pop_show(this.pop_photo.id,this.pop_A,this.pop_photo_slot,this.pop_what);}};F._one_photo_edit_pop.pop_done_hiding=function(){this.style.display="none";_ge(this.pop_shadow_id).shadow_hide();this.pop_photo=null;this.pop_A=null;this.pop_photo_slot=null;this.pop_what=null;this.pop_get_mb().style.display="none";this.pop_change_next_prev_text();this.pop_activate_tab("one_photo_tab_title");this.eb_broadcast("one_photo_onhide");_ge("one_photo_prev_link").style.visibility="hidden";_ge("one_photo_next_link").style.visibility="hidden";_ge("one_photo_goto_next").style.visibility=_ge("one_photo_goto_next_label").style.visibility="hidden";this.pop_clear_form();};F._one_photo_edit_pop.pop_hide=function(){_ge(this.pop_shadow_id).shadow_hide();this.pop_close_license_pop();var pop=this;var _21=function(){pop.pop_done_hiding();};anim_do_opacity_to(pop,5,35,0,"easeInQuad",_21);this.pop_showing=0;};F._one_photo_edit_pop.pop_show_start=function(_22,A,_24,_25,_26){this.pop_were_changes_when_opened=F.changes_count;this.eb_broadcast("one_photo_onshow");this.pop_show(_22,A,_24,_25,_26);};F._one_photo_edit_pop.pop_show=function(_27,A,_28,_29,_30){this.pop_photo=global_photos[_27];this.pop_A=A;this.pop_photo_slot=_28;this.pop_what=_29;this.pop_place();if(!this.pop_fragment_loaded){this.pop_loading=1;this.pop_start_comming("Loading interface...");F.fragment_getter.get("/photo_edit_fragment.gne",{show_belongs:show_belongs},this,"fragment_onLoad");return;}this.style.opacity="1";this.style.filter="alpha(opacity=100)";this.style.display="block";this.pop_get_mb().style.display="block";this.pop_place();_ge(this.pop_shadow_id).shadow_show();if(!_30||(!this.pop_photo||this.pop_photo.description==undefined)){this.pop_loading=1;this.pop_clear_form();this.pop_start_comming("Loading photo info...");F.API.callMethod("flickr.photos.getInfo",{photo_id:_27,get_contexts:show_belongs},this);return;}this.pop_loading=0;this.pop_fill_form();this.pop_change_next_prev_text();this.pop_place();_ge(this.pop_shadow_id).shadow_show();this.pop_showing=1;this.pop_do_focus();};F._one_photo_edit_pop.flickr_photos_getInfo_onLoad=function(_31,_32,_33){if(_31&&_32){var _34=_32.documentElement.getElementsByTagName("photo")[0];var p=_upsert_photo(_34);writeAPIDebug(this.pop_photo.toString());this.pop_stop_comming();this.pop_show(p.id,this.pop_A,this.pop_photo_slot,this.pop_what,1);}else{this.pop_start_comming("There was a problem loading the photo info: "+_33.escape_for_display(),1,1);this.pop_hide();}};F._one_photo_edit_pop.pop_change_next_prev_text=function(_36){var str=(this.pop_what)?"&nbsp;in "+this.pop_what:"";_ge("one_photo_next_link_what").innerHTML=str;_ge("one_photo_prev_link_what").innerHTML=str;_ge("one_photo_goto_what").innerHTML=str;};F._one_photo_edit_pop.window_onresize=function(){this.pop_place();};F._one_photo_edit_pop.pop_place=function(_38,_39){if(window.innerWidth){var ww=window.innerWidth;var wh=window.innerHeight;var bgX=window.pageXOffset;var bgY=window.pageYOffset;}else{var ww=document.body.clientWidth;var wh=document.body.clientHeight;var bgX=document.body.scrollLeft;var bgY=document.body.scrollTop;}var pop=this;var _44=function(){var w=pop.offsetWidth;var x=bgX+_pi((ww-w)/2);x=Math.max(x,1);return x;};var _46=function(){var h=pop.offsetHeight;var y=bgY+_pi((wh-h)/2);y=Math.min(y,90);y=Math.max(y,1);return y;};var x=(typeof _38=="function")?_38():(typeof _38=="number")?_38:_44();var y=(typeof _39=="function")?_39():(typeof _39=="number")?_39:_46();x=Math.max(x,10);y=Math.max(y,10);this.style.left=x+"px";this.style.top=y+"px";if(0&&this.pop_fragment_loaded){this.style.width=this.offsetWidth+"px";this.style.height=this.offsetHeight+"px";}_ge(this.pop_shadow_id).shadow_size_and_place();var mb=pop.pop_get_mb();mb.style.left=bgX+"px";mb.style.top=bgY+"px";mb.style.width=ww+"px";mb.style.height=wh+"px";};F._one_photo_edit_pop.pop_start_comming=function(msg,_50,_51,_52,_53,_54,_55,_56,_57,_58){if(!global_comm_div){_make_comm_div("1002");}x_func=null;var pop=this;y_func=function(){pop.pop_place();return _pi(pop.style.top)+100;};var _59=1;if(this.pop_fragment_loaded){this.pop_place();_59={opacity:"0",filter:"alpha(opacity=0)"};}global_comm_div.start_comming(msg,x_func,y_func,_50,_51,_52,_53,_54,_55,_56,_57,_59,_58);};F._one_photo_edit_pop.pop_stop_comming=function(){global_comm_div.stop_comming();};F._one_photo_edit_pop.pop_go_to_next=function(_60){this.pop_go_to_either(1,0,_60);};F._one_photo_edit_pop.pop_go_to_previous=function(_61){this.pop_go_to_either(-1,0,_61);};F._one_photo_edit_pop.pop_get_next_id=function(){return this.pop_go_to_either(1,1);};F._one_photo_edit_pop.pop_get_previous_id=function(){return this.pop_go_to_either(-1,1);};F._one_photo_edit_pop.pop_go_to_either=function(inc,_63,_64){if(!_63&&_64){if(this.pop_has_changes()){var _65=function(){_ge("one_photo_edit_pop").pop_go_to_either(inc,_63);};_ge("tabl").tabl_start_comming("You have unsaved changes. Press OK to discard them, or cancel to remain on this page",1,1,"OK",_65,1,"CANCEL");return;}}var _66=null;var _67=0;var _68=_ge("findr");if(this.pop_A){curr_index=F.array_index_of(this.pop_A,this.pop_photo.id);_67=this.pop_A[curr_index+inc];}else{if(this.pop_photo_slot!=undefined&&_68){_66=this.pop_photo_slot+inc;_67=_68.findr_get_photo_for_slot(_66).id;}else{writeDebug("unknown context");}}if(_63){return _67;}if(!_67){return;}if(this.pop_loading){return;}this.pop_show(_67,this.pop_A,_66,this.pop_what);};F._one_photo_edit_pop.pop_clear_form=function(){_ge("one_photo_title").value="";_ge("addtagbox").value="";_ge("one_photo_description").value="";_ge("one_photo_img_div").style.visibility="hidden";_ge("one_photo_date_taken_exact").value="";_ge("one_photo_time_taken_exact").value="";_ge("one_photo_date_posted_exact").value="";_ge("one_photo_time_posted_exact").value="";_ge("one_photo_geo_data_lon").value="";_ge("one_photo_geo_data_lat").value="";_ge("one_photo_mat_belongs_list_div").innerHTML="";};F._one_photo_edit_pop.pop_fill_form=function(){var _69=this.pop_get_previous_id();var _70=this.pop_get_next_id();_ge("one_photo_prev_link").style.visibility=(_69)?"visible":"hidden";_ge("one_photo_next_link").style.visibility=(_70)?"visible":"hidden";_ge("one_photo_goto_next").style.visibility=_ge("one_photo_goto_next_label").style.visibility=(_70)?"visible":"hidden";this.pop_is_there_a_next=_70;_ge("one_photo_title").value=this.pop_photo.title;var _71=[];for(var i=0;i<this.pop_photo.tags_rawA.length;i++){var tag=this.pop_photo.tags_rawA[i];if(tag.indexOf(" ")!=-1){tag="\""+tag+"\"";}_71.push(tag);}var _73=_71.join(" ");_ge("addtagbox").value=_73;_ge("one_photo_description").value=this.pop_photo.description.unescape_from_xml();_ge("one_photo_img_div").innerHTML="<img src=\""+_get_photo_src(this.pop_photo,"m")+"\" style=\"\">";_ge("one_photo_img_div").style.visibility="visible";_ge("one_photo_link").href=photos_url+this.pop_photo.id;var _74=this.pop_photo.date_taken.split(" ")[0].split("-");var _75=(_74[1]*1).addZeros(2);var _76=(_74[2]*1).addZeros(2);var _77=_74[0]*1;var _78=_75+"/"+_76+"/"+_77;var _79=this.pop_photo.date_taken.split(" ")[1];_ge("one_photo_date_taken_exact").value=_78;_ge("one_photo_time_taken_exact").value=_79;var _80=_ge("one_photo_date_taken_approx_month");if(this.pop_photo.date_taken_granularity==6){_80.options[0].selected=1;}else{for(var i=_80.options.length-1;i>-1;i--){var _81=_80.options[i];if(_81.value*1==_75){_81.selected=1;break;}}}var _82=_ge("one_photo_date_taken_approx_year");for(var i=_82.options.length-1;i>-1;i--){var _81=_82.options[i];if(_81.value*1==_77){_81.selected=1;break;}}if(this.pop_photo.date_taken_granularity==0){_ge("one_photo_date_taken_exact_div").style.display="block";_ge("one_photo_date_taken_approx_div").style.display="none";_ge("one_photo_date_taken_exact_switcher").style.display="none";_ge("one_photo_date_taken_approx_switcher").style.display="inline";}else{_ge("one_photo_date_taken_exact_div").style.display="none";_ge("one_photo_date_taken_approx_div").style.display="block";_ge("one_photo_date_taken_exact_switcher").style.display="inline";_ge("one_photo_date_taken_approx_switcher").style.display="none";}var _83=_convert_unix_time_stamp(this.pop_photo.date_upload);var _84=(_83.getMonth()+1).addZeros(2);var _85=_83.getDate().addZeros(2);var _86=_83.getFullYear();var _87=_84+"/"+_85+"/"+_86;var _88=_83.getHours().addZeros(2)+":"+_83.getMinutes().addZeros(2)+":"+_83.getSeconds().addZeros(2);_ge("one_photo_date_posted_exact").value=_87;_ge("one_photo_time_posted_exact").value=_88;_ge("one_photo_geo_data_lon").value=this.pop_photo.longitude;_ge("one_photo_geo_data_lat").value=this.pop_photo.latitude;var _89=_ge("one_photo_license_form").one_photo_license;for(var i=0;i<_89.length;i++){var r=_89[i];if(r.value==this.pop_photo.license_id){r.checked=1;break;}}this.pop_change_license_name();_ge("one_photo_is_public").checked=1;_ge("one_photo_is_family").checked=1;_ge("one_photo_is_friend").checked=1;if(this.pop_photo.is_public=="0"){_ge("one_photo_is_private").checked=1;if(this.pop_photo.is_friend!="1"){_ge("one_photo_is_friend").checked=0;}if(this.pop_photo.is_family!="1"){_ge("one_photo_is_family").checked=0;}}var _91={"0":"4","1":"3","2":"2","3":"1"};if(!_91[this.pop_photo.perm_comment]){this.pop_photo.perm_comment=3;}if(!_91[this.pop_photo.perm_addmeta]){this.pop_photo.perm_addmeta=3;}_ge("one_photo_perm_comment_"+_91[this.pop_photo.perm_comment]).checked=1;_ge("one_photo_perm_addmeta_"+_91[this.pop_photo.perm_addmeta]).checked=1;_privacy_specific_change("one_photo_",1);var _92=[];_92.push("<b>Sets:</b><br>");if(this.pop_photo.sets){for(var i=0;i<this.pop_photo.sets.length;i++){var set=global_sets[this.pop_photo.sets[i]];if(!set){continue;}_92.push(this.pop_generate_set_HTML(set));}}else{_92.push("--none--<br>");}_92.push("<br><b>Groups:</b><br>");if(this.pop_photo.pools){for(var i=0;i<this.pop_photo.pools.length;i++){var _94=global_groups[this.pop_photo.pools[i]];if(!_94){continue;}_92.push(this.pop_generate_group_HTML(_94));}}else{_92.push("--none--<br>");}_ge("one_photo_mat_belongs_list_div").innerHTML=_92.join("");this.pop_add_form_handlers();this.pop_form_data_saved=this.pop_get_data_from_form();this.pop_disable_save_and_revert_buttons();if(this.pop_slot&&_ge("findr")){_ge("findr").findr_place_slot_in_mid(this.pop_slot);}};F._one_photo_edit_pop.pop_generate_set_HTML=function(set){var _95=global_photos[set.primary_photo_id];var _96=""+"<table class=\"existing_set_table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td>"+"<img src=\""+_get_photo_src(_95)+"\" width=\"25\" height=\"25\" alt=\"\" title=\"\">"+"</td><td>"+set.title.truncate_with_ellipses(40).escape_for_display()+" (<b>"+set.count.pretty_num()+"</b>)"+"</td></tr></table>";return _96;};F._one_photo_edit_pop.pop_generate_group_HTML=function(_97){var s=(_97.count!=1)?"s":"";var txt=_97.count.pretty_num()+" photo"+s;if(_97.throttle_count){txt+=" <span class=\"group_pipe\"> | </span> Limit: "+_97.throttle_count.pretty_num()+""+_97.throttle_text;}var html=""+"<table class=\"existing_group_table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td valign=\"top\">"+"<img src=\""+_97.icon_src+"\" width=\"24\" height=\"24\" alt=\"\" title=\"\">"+"</td><td><b>"+_97.name.truncate_with_ellipses(40).escape_for_display()+"</b><br>"+txt+""+"</td></tr></table>";return html;};F._one_photo_edit_pop.pop_change_license_name=function(){var _101="";var _102=_ge("one_photo_license_form").one_photo_license;for(var i=0;i<_102.length;i++){var r=_102[i];if(r.checked){_101=_ge("one_photo_license_label"+r.value).innerHTML;break;}}_ge("one_photo_current_license_name").innerHTML=_101;};F._one_photo_edit_pop.pop_do_focus=function(){if(!this.pop_showing){return;}if(this.pop_get_active_tab_id()=="one_photo_tab_title"){_ge("one_photo_title").focus();_ge("one_photo_title").select();}};F._one_photo_edit_pop.pop_get_data_from_form=function(){var ob={};ob.title=_ge("one_photo_title").value;ob.description=_ge("one_photo_description").value;ob.tags=_ge("addtagbox").value;ob.dates=F.get_dates_from_form("one_photo_",0);ob.lat=_ge("one_photo_geo_data_lat").value;ob.lon=_ge("one_photo_geo_data_lon").value;var _104="0";var _105=_ge("one_photo_license_form").one_photo_license;for(var i=0;i<_105.length;i++){if(_105[i].checked){_104=_105[i].value;break;}}ob.license_id=_104;ob.is_private=(_ge("one_photo_is_private").checked)?1:0;ob.is_public=(ob.is_private)?0:1;ob.is_friend=(ob.is_public||_ge("one_photo_is_friend").checked)?1:0;ob.is_family=(ob.is_public||_ge("one_photo_is_family").checked)?1:0;ob.perm_comment="0";if((_ge("one_photo_perm_comment_3").checked)){ob.perm_comment="1";}if((_ge("one_photo_perm_comment_2").checked)){ob.perm_comment="2";}if((_ge("one_photo_perm_comment_1").checked)){ob.perm_comment="3";}ob.perm_addmeta="0";if((_ge("one_photo_perm_addmeta_3").checked)){ob.perm_addmeta="1";}if((_ge("one_photo_perm_addmeta_2").checked)){ob.perm_addmeta="2";}if((_ge("one_photo_perm_addmeta_1").checked)){ob.perm_addmeta="3";}var str="pop_get_data_from_form";for(i in ob){str+="<br>"+i+":"+ob[i];}return ob;};F._one_photo_edit_pop.pop_on_form_activity=function(){if(this.pop_has_changes()){F.changes_were_made("A photo has changed");this.pop_enable_save_and_revert_buttons();}else{if(!this.pop_were_changes_when_opened){F.changes_were_saved();}this.pop_disable_save_and_revert_buttons();}};F._one_photo_edit_pop.pop_add_form_handlers=function(){var _106=function(e){_ge("one_photo_edit_pop").pop_on_form_activity();};var _107=function(e){writeDebug("fff");setTimeout("_ge('one_photo_edit_pop').pop_on_form_activity();",100);};_ge("one_photo_date_taken_exact_switcher").onclick=_ge("one_photo_date_taken_approx_switcher").onclick=function(e){_ge("one_photo_edit_pop").pop_toggle_date_taken();_106();return false;};var _108=function(e){_privacy_specific_change("one_photo_");_106();};var _109=function(e){_ge("one_photo_edit_pop").pop_license_was_switched();_106();};yui.Event.addListener(_ge("one_photo_title"),"change",_106);yui.Event.addListener(_ge("one_photo_title"),"keyup",_106);yui.Event.addListener(_ge("one_photo_title"),"keydown",_107);yui.Event.addListener(_ge("addtagbox"),"change",_106);yui.Event.addListener(_ge("addtagbox"),"keyup",_106);yui.Event.addListener(_ge("addtagbox"),"keydown",_107);yui.Event.addListener(_ge("one_photo_description"),"change",_106);yui.Event.addListener(_ge("one_photo_description"),"keyup",_106);yui.Event.addListener(_ge("one_photo_description"),"keydown",_107);yui.Event.addListener(_ge("one_photo_date_taken_exact"),"change",_106);yui.Event.addListener(_ge("one_photo_date_taken_exact"),"keyup",_106);yui.Event.addListener(_ge("one_photo_date_taken_exact"),"keydown",_107);yui.Event.addListener(_ge("one_photo_date_taken_exact"),"focus",_106);yui.Event.addListener(_ge("one_photo_time_taken_exact"),"change",_106);yui.Event.addListener(_ge("one_photo_time_taken_exact"),"keyup",_106);yui.Event.addListener(_ge("one_photo_time_taken_exact"),"keydown",_107);yui.Event.addListener(_ge("one_photo_date_taken_approx_month"),"change",_106);yui.Event.addListener(_ge("one_photo_date_taken_approx_year"),"change",_106);yui.Event.addListener(_ge("one_photo_date_posted_exact"),"change",_106);yui.Event.addListener(_ge("one_photo_date_posted_exact"),"keyup",_106);yui.Event.addListener(_ge("one_photo_date_posted_exact"),"keydown",_107);yui.Event.addListener(_ge("one_photo_date_posted_exact"),"focus",_106);yui.Event.addListener(_ge("one_photo_time_posted_exact"),"change",_106);yui.Event.addListener(_ge("one_photo_time_posted_exact"),"keyup",_106);yui.Event.addListener(_ge("one_photo_time_posted_exact"),"keydown",_107);if(this.pop_show_loc_els){yui.Event.addListener(_ge("one_photo_geo_data_lon"),"change",_106);yui.Event.addListener(_ge("one_photo_geo_data_lon"),"keyup",_106);yui.Event.addListener(_ge("one_photo_geo_data_lon"),"keydown",_107);yui.Event.addListener(_ge("one_photo_geo_data_lat"),"change",_106);yui.Event.addListener(_ge("one_photo_geo_data_lat"),"keyup",_106);yui.Event.addListener(_ge("one_photo_geo_data_lat"),"keydown",_107);}var _110=_ge("one_photo_license_form").one_photo_license;for(var i=0;i<_110.length;i++){yui.Event.addListener(_110[i],"click",_109);}yui.Event.addListener(_ge("one_photo_is_private"),"click",_108);yui.Event.addListener(_ge("one_photo_is_public"),"click",_108);yui.Event.addListener(_ge("one_photo_is_family"),"click",_108);yui.Event.addListener(_ge("one_photo_is_friend"),"click",_108);for(var i=1;i<5;i++){yui.Event.addListener(_ge("one_photo_perm_comment_"+i),"click",_106);yui.Event.addListener(_ge("one_photo_perm_addmeta_"+i),"click",_106);}yui.Event.addListener(_ge("one_photo_is_private"),"change",_108);yui.Event.addListener(_ge("one_photo_is_public"),"change",_108);yui.Event.addListener(_ge("one_photo_is_family"),"change",_108);yui.Event.addListener(_ge("one_photo_is_friend"),"change",_108);for(var i=1;i<5;i++){yui.Event.addListener(_ge("one_photo_perm_comment_"+i),"change",_106);yui.Event.addListener(_ge("one_photo_perm_addmeta_"+i),"change",_106);}this.pop_add_form_handlers=function(){};};F._one_photo_edit_pop.pop_toggle_date_taken=function(){if(_ge("one_photo_date_taken_exact_div").style.display=="none"){_ge("one_photo_date_taken_exact_div").style.display="block";_ge("one_photo_date_taken_approx_div").style.display="none";_ge("one_photo_date_taken_exact_switcher").style.display="none";_ge("one_photo_date_taken_approx_switcher").style.display="inline";}else{_ge("one_photo_date_taken_exact_div").style.display="none";_ge("one_photo_date_taken_approx_div").style.display="block";_ge("one_photo_date_taken_exact_switcher").style.display="inline";_ge("one_photo_date_taken_approx_switcher").style.display="none";}};F._one_photo_edit_pop.pop_disable_save_and_revert_buttons=function(){this.pop_disable_save_button();this.pop_disable_revert_button();};F._one_photo_edit_pop.pop_enable_save_and_revert_buttons=function(){this.pop_enable_save_button();this.pop_enable_revert_button();};F._one_photo_edit_pop.pop_disable_save_button=function(){_ge("one_photo_save").disabled=true;_ge("one_photo_save").className="DisabledButt";};F._one_photo_edit_pop.pop_enable_save_button=function(){_ge("one_photo_save").disabled=false;_ge("one_photo_save").className="Butt";};F._one_photo_edit_pop.pop_disable_revert_button=function(){_ge("one_photo_revert_link").style.visibility="hidden";_ge("one_photo_revert_link").onclick=function(){this.blur();return false;};};F._one_photo_edit_pop.pop_enable_revert_button=function(){_ge("one_photo_revert_link").style.visibility="visible";_ge("one_photo_revert_link").onclick=function(){this.blur();_ge("one_photo_edit_pop").pop_revert();return false;};};F._one_photo_edit_pop.pop_delete_photo=function(_111){if(!_111){var msg="You really want to delete this photos? It will be gone forever, and cannot be recovered.";var pop=this;var _112=function(){pop.pop_delete_photo(1);};this.pop_start_comming(msg,1,1,"yes, delete",_112,1,"no!");return;}this.pop_start_comming("Deleting photo...");F.API.callMethod("flickr.photos.delete",{photo_id:this.pop_photo.id},this);};F._one_photo_edit_pop.flickr_photos_delete_onLoad=function(_113,_114,_115){if(_113){this.pop_done_deleting();}else{this.pop_start_comming("There was an error: "+_115.escape_for_display(),1,1);}};F._one_photo_edit_pop.pop_done_deleting=function(){if(!this.pop_were_changes_when_opened){F.changes_were_saved();}this.pop_stop_comming();this.eb_broadcast("one_photo_on_save",this.pop_photo.id,0,1);this.pop_hide();var _116=global_photos[this.pop_photo.id];global_photos[this.pop_photo.id]=null;delete global_photos[this.pop_photo.id];};F._one_photo_edit_pop.pop_save=function(){var _117="";if(_117!=""){alert(_117);return;}exp_rsps=0;var _118=this.pop_what_changed();this.pop_changed_dates=_118.dates;var now=_118.now;if(_118.dates){exp_rsps++;}if(_118.meta){exp_rsps++;}if(_118.tags){exp_rsps++;}if(_118.perms){exp_rsps++;}if(_118.geo){exp_rsps++;}if(_118.license){exp_rsps++;}if(!exp_rsps){writeDebug("nothing saved");this.pop_done_saving();return;}this.pop_start_comming("Saving...");var _120={exp_rsps:exp_rsps,rec_rsps:0,tabl:this};_120.flickr_photos_setTags_onLoad=_120.flickr_photos_setMeta_onLoad=_120.flickr_photos_setPerms_onLoad=_120.flickr_photos_setGeoData_onLoad=_120.flickr_photos_licenses_setLicense_onLoad=_120.flickr_photos_setDates_onLoad=function(_121,_122,_123){this.rec_rsps++;if(_121){}else{}if(this.rec_rsps==this.exp_rsps){this.tabl.pop_done_saving(1);}};if(_118.tags){F.API.callMethod("flickr.photos.setTags",{photo_id:this.pop_photo.id,tags:now.tags},_120);}if(_118.meta){F.API.callMethod("flickr.photos.setMeta",{photo_id:this.pop_photo.id,title:now.title,description:now.description},_120);}if(_118.dates){F.API.callMethod("flickr.photos.setDates",{photo_id:this.pop_photo.id,date_posted:now.dates.date_posted,date_taken:now.dates.date_taken,date_taken_granularity:now.dates.date_taken_granularity},_120);}if(_118.geo){F.API.callMethod("flickr.photos.setGeoData",{photo_id:this.pop_photo.id,lat:now.lat,lon:now.lon,accuracy:0},_120);}if(_118.license){F.API.callMethod("flickr.photos.licenses.setLicense",{photo_id:this.pop_photo.id,license_id:now.license_id},_120);}if(_118.perms){var _124={photo_id:this.pop_photo.id,is_public:now.is_public,is_friend:now.is_friend,is_family:now.is_family,perm_comment:now.perm_comment,perm_addmeta:now.perm_addmeta};F.API.callMethod("flickr.photos.setPerms",_124,_120);}};F._one_photo_edit_pop.pop_done_saving=function(_125){if(!this.pop_were_changes_when_opened){F.changes_were_saved();}this.pop_stop_comming();if(_125){this.eb_broadcast("one_photo_on_save",this.pop_photo.id,this.pop_changed_dates);}if(_ge("one_photo_goto_next").checked&&this.pop_is_there_a_next){this.pop_go_to_next();}else{this.pop_hide();}};F._one_photo_edit_pop.pop_cancel=function(_126){if(this.pop_has_changes()&&!_126){var _127=function(){_ge("one_photo_edit_pop").pop_cancel(1);};_ge("tabl").tabl_start_comming("You have unsaved changes. Press OK to discard them, or cancel to remain on this page",1,1,"OK",_127,1,"CANCEL");return;}if(!this.pop_were_changes_when_opened){F.changes_were_saved();}this.pop_hide();};F._one_photo_edit_pop.pop_revert=function(){this.pop_fill_form();if(!this.pop_were_changes_when_opened){F.changes_were_saved();}};F._one_photo_edit_pop.pop_has_changes=function(){if(this.pop_loading){return 0;}var _128=this.pop_what_changed();if(_128.dates){return 1;}if(_128.meta){return 1;}if(_128.tags){return 1;}if(_128.perms){return 1;}if(_128.geo){return 1;}if(_128.license){return 1;}return 0;};F._one_photo_edit_pop.pop_what_changed=function(){var ob={};ob.dates=0;ob.meta=0;ob.tags=0;ob.perms=0;ob.geo=0;ob.license_id=0;var then=this.pop_form_data_saved;var now=this.pop_get_data_from_form();ob.now=now;if(now.title!=then.title){ob.meta=1;}else{if(now.description!=then.description){ob.meta=1;}}if(now.tags!=then.tags){ob.tags=1;}if(now.dates.date_posted!=then.dates.date_posted){ob.dates=1;}else{if(now.dates.date_taken!=then.dates.date_taken){ob.dates=1;}else{if(now.dates.date_taken_granularity!=then.dates.date_taken_granularity){ob.dates=1;}}}if(this.pop_show_loc_els){if(now.lat!=then.lat){ob.geo=1;}else{if(now.lon!=then.lon){ob.geo=1;}}}if(now.license_id!=then.license_id){ob.license=1;}if(now.is_private!=then.is_private){ob.perms=1;}else{if(now.is_friend!=then.is_friend){ob.perms=1;}else{if(now.is_family!=then.is_family){ob.perms=1;}else{if(now.perm_comment!=then.perm_comment){ob.perms=1;}else{if(now.perm_addmeta!=then.perm_addmeta){ob.perms=1;}}}}}return ob;};
