F.API={};F.API.callMethod=function(_1,_2,_3,_4,_5,_6,_7,_8){if(typeof _2!="object"){_2={};}_2.method=_1;var _9=(_7)?0:1;var _10="/services/rest/";if(_6){_10=_6+_10;}_2.src="js";_2.api_key=global_magisterLudi;_2.auth_hash=global_auth_hash;_2.auth_token=global_auth_token;_2.cb=new Date().getTime();var _11=[];var _12="";for(var p in _2){if(p=="RESTURL"){continue;}_2[p]=_2[p];_11.push(p);_12+="&"+p+"="+escape_utf8(_2[p]);}_11.sort();var cal=global_flickr_secret;if(cal!=""){for(var i=0;i<_11.length;i++){cal+=_11[i]+_2[_11[i]];}cal=md5_calcMD5(cal);_12="api_sig="+cal+_12;}_2.RESTURL=_12;var _5=(_5==undefined)?1:_5;var req=new XMLHttpRequest();var _17={};if(_9){F.eb_add(_17);_17.window_onbeforeunload=function(_18){F.eb_remove(_17);req.onreadystatechange=function(){};req.abort();if(_18&&typeof F.API=="object"){F.API.handleResponse(null,_1,_2,"Action cancelled by window unload. Try again please!",_3);}};}_2.timer_index=_page_timer.add("before api call "+_2.method);if(req){req.onreadystatechange=function(){if(req.readyState==4){if(req.responseText==""&&_5<2){_5++;req.abort();F.API.callMethod(_1,_2,_3,_4,_5,_6,_9);}else{F.eb_remove(_17);if(typeof F.API=="object"){F.API.handleResponse(req.responseXML,_1,_2,req.responseText,_3);}}}};if(_4){_10=_4;}req.open("POST",_10,_9);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(_9&&_8){writeAPIDebug("delaying API call "+_8+" milliseconds for "+_10+"?"+_12);setTimeout(function(){writeAPIDebug(_10+"?"+_12);req.send(_12);},_8);}else{writeAPIDebug(_10+"?"+_12);req.send(_12);}if(!_9){this.handleResponse(req.responseXML,_1,_2,req.responseText,_3);}}};F.API.getCallBackName=function(_19){return _19.split(".").join("_")+"_onLoad";};F.API.handleResponse=function(_20,_21,_22,_23,_24){if(!_20){var _25=(_23.indexOf("stat=\"ok\"")>-1)?true:false;}else{var _25=(_20.documentElement&&_20.documentElement.getAttribute("stat")=="ok")?true:false;}writeAPIDebug(_23);_page_timer.add("after api call "+_22.method);_page_timer.dump(_22.timer_index);_24=(_24)?_24:this;_24[this.getCallBackName(_21)](_25,_20,_23,_22);};F.fragment_getter={};F.fragment_getter.get=function(url,_27,_28,_29,_30,_31,_32,_33){if(typeof _27!="object"){_27={};}var _34=(_32)?0:1;var _35=url;if(_31){_35=_31+_35;}var _36="?src=js";for(var p in _27){_36+="&"+p+"="+escape_utf8(_27[p]);}_36+="&cb="+new Date().getTime();_27.RESTURL=_36;var _30=(_30==undefined)?1:_30;var req=new XMLHttpRequest();if(req){req.onreadystatechange=function(){if(req.readyState==4){if(req.responseText==""&&_30<1){_30++;req.abort();F.fragment_getter.get(url,_27,_28,_29,_30,_31,_32,_33);}else{F.fragment_getter.handleResponse(_29,_27,req.responseText,_28);}}};req.open("GET",_35+_36);if(_34&&_33){writeAPIDebug("delaying fragment call "+_33+" milliseconds for "+_35+_36);setTimeout(function(){writeAPIDebug(_35+_36);req.send((null));},_33);}else{writeAPIDebug(_35+_36);req.send(null);}}};F.fragment_getter.handleResponse=function(_37,_38,_39,_40){_40=(_40)?_40:this;writeAPIDebug(_39);_40[_37](1,_39,_38);};var escape_utf8=function(_41){if(_41==""||_41==null){return "";}_41=_41.toString();var _42="";for(var i=0;i<_41.length;i++){var c=_41.charCodeAt(i);var bs=new Array();if(c>65536){bs[0]=240|((c&1835008)>>>18);bs[1]=128|((c&258048)>>>12);bs[2]=128|((c&4032)>>>6);bs[3]=128|(c&63);}else{if(c>2048){bs[0]=224|((c&61440)>>>12);bs[1]=128|((c&4032)>>>6);bs[2]=128|(c&63);}else{if(c>128){bs[0]=192|((c&1984)>>>6);bs[1]=128|(c&63);}else{bs[0]=c;}}}if(bs.length>1){for(var j=0;j<bs.length;j++){var b=bs[j];var hex=nibble_to_hex((b&240)>>>4)+nibble_to_hex(b&15);_42+="%"+hex;}}else{_42+=encodeURIComponent(String.fromCharCode(bs[0]));}}return _42;};var nibble_to_hex=function(_48){var _49="0123456789ABCDEF";return _49.charAt(_48);};
