var decorate_photo_notes=function(_1){if(!_ok_for_scrumjax()){return;}var EL=_1[0];EL.EXT=new Photo_Notes_Container_EXT(_1[0],_1[1],_1[2],_1[3],_1[4]);return EL;};Photo_Notes_Container_EXT=function(el,_4,_5,_6,_7){var EL=this.EL=el;var _8=this;_8.hex_colors={yellow:"#ffffd3",green:"#d0fdaf"};_8.isOver=_8.editing=_8.dragging=0;_8.hide_while_dragging=0;_8.which_note=null;_8.photo_div=_4;_8.photo_div.onmouseover=function(){EL.onmouseover();};_8.photo_div.onmouseout=function(e){var s=_get_event_src(e);if(window.should_I_ignore_stuff_because_of_button_action||window.should_I_ignore_stuff_because_of_editable_div_action||global_comm_div.comming){return;}_8.hide_tim=setTimeout("_ge('photo_notes').EXT.take_her_away('EXT.photo_div.onmouseout');",200);};_8.p_id=_5;_8.rotate_version=_7;_8.thumb_url=_6+"?cb="+new Date().getTime();_8.notes_text_div=_ge("notes_text_div");var _11="<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:0px;\" id=\"notes_text_table\">"+"<tr><td><img width=\"3\" height=\"3\" src=\"/images/tc_yellow_tl.gif\"></td><td class=\"td_note_yeller\"></td><td><img width=\"3\" height=\"3\" src=\"/images/tc_yellow_tr.gif\"></td></tr>"+"<tr><td class=\"td_note_yeller\"></td>"+"<td class=\"td_note_yeller\" style=\"padding:3px\">"+"<span id=\"notes_text_span\" style=\"font-family:arial; font-size:12px;\"></span>"+"<form id=\"notes_text_form\"><input type=\"hidden\" name=\"magic_cookie\" value=\""+global_auth_hash+"\" />"+"<textarea onkeydown=\"_limit_textarea(this, 300)\" onkeyup=\"place_notes_text_div(); adjust_textarea_height(this); _limit_textarea(this, 300)\" id=\"notes_text_area\" rows="+1+"; style=\"overflow:visible; width: 200px; font-family:arial; font-size:12px; padding:0px; border:0px inset #e9e9ae; background-color:#ffffd3;\" wrap=\"virtual\"></textarea>"+"</form>"+"</td><td class=\"td_note_yeller\"></td></tr>"+"<tr><td><img width=\"3\" height=\"3\" src=\"/images/tc_yellow_bl.gif\"></td><td class=\"td_note_yeller\"></td><td><img width=\"3\" height=\"3\" src=\"/images/tc_yellow_br.gif\"></td></tr></table>"+"<form id=\"notes_text_buttons_form\">"+"<input type=\"button\" class=\"Butt\" value=\"SAVE\" onclick=\"_ge('"+EL.id+"').EXT.save_editing(); this.blur();\" style=\"margin:5px 5px 0 0;\">"+"<input type=\"button\" class=\"CancelButt\" value=\"CANCEL\" onclick=\"_ge('"+EL.id+"').EXT.cancel_editing(); this.blur();\" style=\"margin:5px 5px 0 0;\">"+"<input type=\"button\" class=\"CancelButt\" value=\"DELETE\" id=\"delete_note_button\" onclick=\"_ge('"+EL.id+"').EXT.delete_note(); this.blur();\" style=\"margin:5px 5px 0 0;\">"+"</form><div id=\"temp_div\" style=\"visibility:hidden;\"></div>";_8.notes_text_div.innerHTML=_11;_8.notes_text_table=_ge("notes_text_table");_8.notes_text_span=_ge("notes_text_span");_8.notes_text_area=_ge("notes_text_area");if(!document.all||navigator.userAgent.indexOf("Opera")!=-1){_8.notes_text_area.style.height="58px";}_8.notes_text_form=_ge("notes_text_form");_8.notes_text_buttons_form=_ge("notes_text_buttons_form");_8.delete_note_button=_ge("delete_note_button");_8.notes_text_div.style.zIndex="1000";_8.notes_text_div.style.display="none";_8.notes_text_div.style.width="220px";_8.notes_text_div.style.position="relative";if(navigator.userAgent.indexOf("Mozilla/5.0")!=-1&&navigator.userAgent.indexOf("KHTML")==-1){}else{}window.temp_div=_ge("temp_div");temp_div.style.width=_8.notes_text_area.style.width;_8.notes_text_table.onmouseover=function(){if(_8.editing){return;}if(_8.which_note){clearTimeout(_8.which_note.EXT.hide_timmy);}};_8.notes_text_table.onmouseout=function(){if(_8.editing){return;}if(_8.which_note){_8.which_note.EXT.box_div.onmouseout();}};_8.notes_text_table.onmouseup=function(e){if(_8.editing){return;}var s=_get_event_src(e);if(s&&_el_is_in_a_link(s)){return;}if(_8.which_note&&_8.which_note.EXT.can_edit){_8.which_note.EXT.editing=1;_8.which_note.EXT.change_display();_8.start_editing_one(_8.which_note);}};_make_comm_div("1002");global_comm_div.button_cancel.onclick_plus=global_comm_div.button_ok.onclick_plus=function(){_8.stop_comming();};_8.rotate_div=_ge("rotate_div");var _11="<table id=\"rotate_table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:218px; padding:0px;\">";_11+="<tr><td width=\"3\"><img width=\"3\" height=\"3\" src=\"/images/tc_white_tl.gif\"></td><td class=\"td_note_white\"></td><td width=\"3\"><img width=\"3\" height=\"3\" src=\"/images/tc_white_tr.gif\"></td></tr>";_11+="<tr><td class=\"td_note_white\"></td>";_11+="<td class=\"td_note_white\" style=\"padding:0px; height:155px\"><span id=\"rotate_span\" style=\"font-family:arial; font-size:12px;\"></span>";_11+="</td><td class=\"td_note_white\"></td></tr>";_11+="<tr><td><img width=\"3\" height=\"3\" src=\"/images/tc_white_bl.gif\"></td><td class=\"td_note_white\"></td><td><img width=\"3\" height=\"3\" src=\"/images/tc_white_br.gif\"></td></tr></table>";_8.rotate_div.innerHTML=_11;_8.rotate_table=_ge("rotate_table");_8.rotate_span=_ge("rotate_span");_8.rotate_div.style.zIndex="1003";_8.rotate_div.style.display="none";for(var i=0;i<EL.childNodes.length;i++){if(EL.childNodes[i].className=="photo_note"){EL.childNodes[i].EXT.papa=EL;}}EL.onmouseover=function(){clearTimeout(this.EXT.hide_tim);if(!this.EXT.shown_initially){this.EXT.tried_to_show_before_shown_initially=1;return;}if(window.should_I_ignore_stuff_because_of_button_action||window.should_I_ignore_stuff_because_of_editable_div_action||global_comm_div.comming){return;}this.EXT.isOver=1;this.EXT.change_display();};window.hide_rotate_div=function(){_8.hide_rotate_div();};window.save_rotation=function(_13){_8.save_rotation(_13);};this.go_away_in_a_bit=function(){_8.hide_tim=setTimeout("_ge('photo_notes').EXT.take_her_away('go_away_in_a_bit');",3000);};this.take_her_away=function(_14){clearTimeout(_8.hide_tim);if(_8.editing||global_comm_div.comming||_8.dragging){return;}_8.isOver=0;_8.stop_showing_one("take_her_away "+_14);_8.change_display();};this.show_rotate_div=function(_15){if(_8.rotate_div.style.display!="none"){return;}_8.rotate_div.style.display="block";_8.rotate_div.style.visibility="hidden";global_single_shadow_div.style.visibility="hidden";_8.button_acting=_15;var x=_pi((_8.get_image_w()-_pi(_8.rotate_table.offsetWidth))/2);var y=_pi((_8.get_image_h()-150)/2);if(y<10){y=10;}if(x<10){x=10;}_8.rotate_div.style.marginLeft=x+"px";_8.rotate_div.style.marginTop=y+"px";var _18="/apps/rotate/rotate.swf?thumb_url="+_8.thumb_url+"&v="+_8.rotate_version+"&cb="+new Date().getTime();_8.take_her_away("show_rotate_div");window.should_I_ignore_stuff_because_of_button_action=1;if(!_8.rotate_swf_html){var _19="<OBJECT classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0\" ";_19+="WIDTH=\"212\" HEIGHT=\"145\" id=\"photo\" ALIGN=\"\">";_19+="<PARAM NAME=movie VALUE=\""+_18+"\"><PARAM NAME=quality VALUE=high>";_19+="<PARAM NAME=bgcolor VALUE=#ffffff>";_19+="<EMBED src=\""+_18+"\" quality=high bgcolor=#ffffff  WIDTH=\"212\" HEIGHT=\"145\" NAME=\"photo\"";_19+=" ALIGN=\"\" TYPE=\"application/x-shockwave-flash\" PLUGINSPAGE=\"http://www.macromedia.com/go/getflashplayer\"></EMBED></OBJECT>";_8.rotate_swf_html=_19;}if(navigator.userAgent.indexOf("KHTML")!=-1){_8.insert_rotate_swf_and_show_tim=setTimeout("_ge('photo_notes').EXT.insert_rotate_swf_and_show()",50);}else{if(_8.rotate_span.innerHTML==""){_8.insert_rotate_swf_and_show();}else{_8.rotate_div.style.visibility="visible";global_single_shadow_div.style.visibility="visible";}}global_single_shadow_div.style.display="block";_set_single_shadow_x(x);_set_single_shadow_y(y);_set_single_shadow_height(_8.rotate_table);_set_single_shadow_width(_8.rotate_table);};this.insert_rotate_swf_and_show=function(){_8.rotate_span.innerHTML=_8.rotate_swf_html;_8.rotate_div.style.visibility="visible";_set_single_shadow_height(_8.rotate_table);global_single_shadow_div.style.visibility="visible";};this.hide_rotate_div=function(){_8.rotate_div.style.display="none";global_single_shadow_div.style.display="none";window.should_I_ignore_stuff_because_of_button_action=0;if(_8.button_acting){_8.button_acting.EXT.enable_others();}};this.save_rotation=function(_20){_8.hide_rotate_div();if(_20=="-90"){_20=270;}if(_20=="-180"){_20=180;}_8.start_comming("Rotating photo...");var _21={photo_id:_8.p_id,degrees:_20};F.API.callMethod("flickr.photos.transform.rotate",_21,_8);};this.flickr_photos_transform_rotate_onLoad=function(_22,_23,_24){if(_22){document.location=page_current_url+"?rotated=1&cb="+new Date().getTime();}else{alert("There was an error: "+_24);_8.stop_comming();}};this.make_note_this_color=function(_25){var _26=(_8.last_note_color)?_8.last_note_color:"yellow";if(_26==_25){return;}_8.notes_text_area.style.backgroundColor=_8.hex_colors[_25];var tds=EL.getElementsByTagName("TD");for(var i=0;i<tds.length;i++){if(tds[i].className=="td_note_yeller"){tds[i].style.backgroundColor=_8.hex_colors[_25];}}var _28=EL.getElementsByTagName("IMG");for(var i=0;i<_28.length;i++){if(_28[i].src){_28[i].src=_28[i].src.replace(_26,_25);}}_8.last_note_color=_25;};this.start_showing_one=function(_29){clearTimeout(_8.hide_tim);if(_8.which_note){clearTimeout(_8.which_note.EXT.hide_timmy);}if(_8.which_note!=_29){_8.stop_showing_one();}_8.make_note_this_color(_29.EXT.use_color);var txt=_29.EXT.render_text_for_display();if(!_29.EXT.from_owner){txt+="  - <a href=\"/photos/"+_29.EXT.author+"\"><i>"+_29.EXT.author_name+"</i></a>";}_8.notes_text_span.innerHTML=txt;_8.which_note=_29;if(_8.editing){_8.notes_text_span.style.display="none";_8.notes_text_form.style.display="block";_8.notes_text_buttons_form.style.display="block";if(_8.which_note.id=="photo_note_temp"){_8.delete_note_button.style.display="none";}else{_8.delete_note_button.style.display="inline";}if(_29!=_8.which_note||_8.notes_text_area.value==""){_8.notes_text_area.value=_29.EXT.saved_txt;adjust_textarea_height(_8.notes_text_area);}}else{_8.notes_text_span.style.display="inline";_8.notes_text_form.style.display="none";_8.notes_text_buttons_form.style.display="none";}_8.notes_text_div.style.display="block";global_single_shadow_div.style.display="block";_set_single_shadow_height(_8.notes_text_table);_set_single_shadow_width(_8.notes_text_table);_8.place_notes_text_div();if(_8.editing){_8.notes_text_area.focus();_8.notes_text_area.select();}};this.place_notes_text_div=function(_31,_32){if(_31&&_32){var nx=_31;var ny=_32+_8.which_note.EXT.get_note_h()+5;}else{if(_8.editing){var _35=0;var _36=200;}else{var _35=100;var _36=200;}var nx=_pi(_8.which_note.style.left);var ny=_pi(_8.which_note.style.top)+_8.which_note.EXT.get_note_h()+5;if(ny+_8.notes_text_div.offsetHeight>_8.get_image_h()+_35){ny=_pi(_8.which_note.style.top)-_8.notes_text_div.offsetHeight-10;if(document.all&&navigator.userAgent.indexOf("Opera")==-1){ny+=15;}}if(ny<-_36){ny=_pi(_8.which_note.style.top)+_8.which_note.EXT.get_note_h()+5;}}_8.notes_text_div.style.left=nx+"px";_8.notes_text_div.style.top=ny+"px";_set_single_shadow_x(nx);_set_single_shadow_y(ny);};this.stop_showing_one=function(_37){_8.notes_text_div.style.display="none";global_single_shadow_div.style.display="none";if(_8.which_note){_8.which_note.EXT.isOver=0;_8.which_note.EXT.change_display();}};this.start_dragging_one=function(){_8.dragging=1;window.should_I_ignore_stuff_because_note_editing=1;};this.start_editing_one=function(_38){_8.editing=1;_8.dragging=0;window.should_I_ignore_stuff_because_note_editing=1;_8.start_showing_one(_38);};this.hide_notes_text_div=function(){_8.notes_text_div.style.display="none";global_single_shadow_div.style.display="none";};this.refresh_notes=function(){if(_ok_for_scrumjax_xml()){var _39={photo_id:_8.p_id};F.API.callMethod("flickr.photos.getInfo",_39,_8);}else{document.location=page_current_url+"?changednotes=1&cb="+new Date().getTime();}};this.flickr_photos_getInfo_onLoad=function(_40,_41,_42,_43){if(_40){var _44={};var _45=_41.documentElement.getElementsByTagName("owner")[0].getAttribute("nsid");var _46=_41.documentElement.getElementsByTagName("note");for(var t=0;t<_46.length;t++){var _48=_46[t].firstChild.nodeValue;var _49=_46[t].getAttribute("x")*1;var _50=_46[t].getAttribute("y")*1;var _51=_46[t].getAttribute("w")*1;var _52=_46[t].getAttribute("h")*1;var _53=_46[t].getAttribute("id");var _54=_46[t].getAttribute("author");var _55=_46[t].getAttribute("authorname");_44[_53]=_53;var _56=_ge("photo_note_"+_53);if(_56){_56.EXT.refresh_info(_53,_49,_50,_51,_52,_48);}else{var _57=(global_nsid==_54||global_photos[_8.p_id].isOwner)?1:0;var _58=(_45==_54);_8.create_note(_53,_49,_50,_51,_52,_48,_57,_58,_55,_54);}}for(var i=EL.childNodes.length-1;i>=0;i--){if(EL.childNodes[i].className=="photo_note"){if(!_44[EL.childNodes[i].EXT.note_id]){F.remove_el(EL.childNodes[i],EL);}}}}else{alert("There was an error: "+_42);}if(global_comm_div.comming){_8.stop_comming();}};this.start_comming=function(msg,_60,_61,_62,_63,_64,_65,_66){window.should_I_ignore_stuff_because_note_editing=1;EL.style.visibility="hidden";var _67=function(){var x=_pi((_8.get_image_w()-_pi(global_comm_div.table.offsetWidth))/2);if(x<10){x=10;}return x;};var _68=function(){var y=_pi((_8.get_image_h()-global_comm_div.table.offsetHeight)/2);if(y<10){y=10;}return y;};global_comm_div.start_comming(msg,_67,_68,_60,_61,_62,_63,_64,_65,_66);};this.stop_comming=function(_69){window.should_I_ignore_stuff_because_note_editing=0;global_comm_div.stop_comming();if(!_69){EL.style.visibility="visible";}};this.start_adding_note=function(){if(_8.editing){alert("You can only add one note at a time.");return;}_8.empty_notes_text_area();EL.onmouseover();var _70=_8.create_note("temp",20,20,50,50,"Add your note here.",1,global_photos[_8.p_id].isOwner,"","");_70.EXT.start_editing();_8.start_editing_one(_70);};this.create_note=function(_71,_72,_73,_74,_75,_76,_77,_78,_79,_80){var _81=document.createElement("DIV");_81.className="photo_note";_81.id="photo_note_"+_71;_81.style.left=(_72+1)+"px";_81.style.top=(_73+1)+"px";var _11="<div class=\"photo_note_box_div\"><div class=\"photo_note_box_inner_div\">";_11+="<div class=\"photo_note_box_inner_inner_div\"><div style=\"width:"+(_74-4)+"px; height:"+(_75-4)+"px;\">";_11+="</div></div></div></div><div class=\"photo_note_text_div\"></div>";_81.innerHTML=_11;EL.appendChild(_81);_decorate(_81,_71,_77,_78,_79,_80,_76);_81.EXT.papa=EL;return _81;};this.delete_note=function(){deja_view_uh_huh();_8.which_note.EXT.stop_editing(0);_8.editing=0;_8.stop_showing_one();_8.empty_notes_text_area();_8.start_comming("Deleting note...");var _82={note_id:_8.which_note.EXT.note_id};F.API.callMethod("flickr.photos.notes.delete",_82,_8);};this.flickr_photos_notes_delete_onLoad=function(_83,_84,_85){if(!_83&&(!_85||_85.indexOf("not found")==-1)){alert("There was an error: "+_85);_8.stop_comming();}_8.refresh_notes();};this.cancel_editing=function(){_8.which_note.EXT.stop_editing(1);_8.editing=0;window.should_I_ignore_stuff_because_note_editing=0;_8.stop_showing_one();_8.empty_notes_text_area();if(_8.which_note.id=="photo_note_temp"){F.remove_el(_8.which_note,EL);}};this.empty_notes_text_area=function(){_8.notes_text_area.value="";};this.save_editing=function(){if(_8.notes_text_area.value==""){_8.notes_text_area.focus();_8.notes_text_area.select();return;}deja_view_uh_huh();_8.which_note.EXT.stop_editing(0);_8.editing=0;_8.stop_showing_one();if(_8.which_note.id=="photo_note_temp"){_8.start_comming("Saving new note...");var _86={photo_id:_8.p_id,note_x:_8.which_note.EXT.get_note_x(),note_y:_8.which_note.EXT.get_note_y(),note_w:(_8.which_note.EXT.get_note_w()),note_h:(_8.which_note.EXT.get_note_h()),note_text:_8.notes_text_area.value};F.API.callMethod("flickr.photos.notes.add",_86,_8);F.remove_el(_8.which_note,EL);}else{_8.start_comming("Saving changes to note...");var _86={note_id:_8.which_note.EXT.note_id,note_x:_8.which_note.EXT.get_note_x(),note_y:_8.which_note.EXT.get_note_y(),note_w:(_8.which_note.EXT.get_note_w()),note_h:(_8.which_note.EXT.get_note_h()),note_text:_8.notes_text_area.value};F.API.callMethod("flickr.photos.notes.edit",_86,_8);}_8.empty_notes_text_area();};this.flickr_photos_notes_add_onLoad=function(_87,_88,_89){if(_87){_8.refresh_notes();}else{alert("There was an error: "+_89);_8.stop_comming();}};this.flickr_photos_notes_edit_onLoad=function(_90,_91,_92){if(_90){_8.refresh_notes();}else{alert("There was an error: "+_92);_8.stop_comming();}};this.flickr_test_echo_onLoad=function(_93,_94,_95){if(_93){}else{alert("There was an error: "+_95);_8.stop_comming();}};this.get_image_w=function(){return _8.photo_div.childNodes[0].width;};this.get_image_h=function(){return _8.photo_div.childNodes[0].height;};this.change_display=function(){if(_8.isOver){EL.style.visibility="visible";}else{EL.style.visibility="hidden";}};};var decorate_photo_note=function(_96){if(!_ok_for_scrumjax()){return;}var EL=_96[0];EL.EXT=new Photo_Note_EXT(_96[0],_96[1],_96[2],_96[3],_96[4],_96[5],_96[6]);return EL;};Photo_Note_EXT=function(el,_97,_98,_99,_100,_101,_102){var EL=this.EL=el;var EXT=this;EXT.note_id=_97;EXT.can_edit=_98;EXT.author_name=_100;EXT.author=_101;EXT.from_owner=_99;EXT.use_color=(EXT.from_owner)?"yellow":"green";EXT.isOver=0;EXT.editing=0;EXT.isDragging=0;EXT.resize_box_size=8;EXT.last_rendered_txt="";EXT.box_div=EL.childNodes[0];EXT.innermost_div=EXT.box_div.childNodes[0].childNodes[0].childNodes[0];if(document.all&&!window.opera){EXT.innermost_div.style.backgroundColor="#fff";EXT.innermost_div.style.filter="alpha(opacity:0)";}EXT.text_div=EL.childNodes[1];EXT.saved_txt=_102;EXT.saved_x=_pi(EL.style.left);EXT.saved_y=_pi(EL.style.top);EXT.saved_w=_pi(EXT.innermost_div.style.width);EXT.saved_h=_pi(EXT.innermost_div.style.height);EL.appendChild(EXT.make_resize_div("nw"));EL.appendChild(EXT.make_resize_div("ne"));EL.appendChild(EXT.make_resize_div("sw"));EL.appendChild(EXT.make_resize_div("se"));EXT.box_div.onmouseover=EXT.onmouseover;EXT.box_div.onmouseout=EXT.onmouseout;if(EXT.can_edit){EXT.box_div.onmousedown=EXT.onmousedown;EXT.box_div.style.cursor=(document.all&&!window.opera)?"hand":"pointer";}};Photo_Note_EXT.prototype.make_resize_div=function(_104){var EL=this.EL;var EXT=this;var ref="resize_"+_104+"_div";EXT[ref]=document.createElement("DIV");EXT[ref].style.position="absolute";EXT[ref].style.display="none";EXT[ref].style.cursor=_104+"-resize";EXT[ref].style.top=(_104=="ne"||_104=="nw")?"0px":(EXT.get_note_h()-EXT.resize_box_size)+"px";EXT[ref].style.left=(_104=="sw"||_104=="nw")?"0px":(EXT.get_note_w()-EXT.resize_box_size)+"px";EXT[ref].style.backgroundColor="#fff";EXT[ref].innerHTML="<div style=\"border:1px solid black\"><div style=\"width:"+(EXT.resize_box_size-2)+"px; height:"+(EXT.resize_box_size-2)+"px; background-color:#fff; font-size:1px\"></div></div>";EXT[ref].onmousedown=function(e){e||(e=window.event);EXT.start_dragging_resize(e,_104);};EXT[ref].EL=EL;return EXT[ref];};Photo_Note_EXT.prototype.render_text_for_display=function(){var EL=this.EL;var EXT=this;var txt=EXT.saved_txt;if(EXT.last_saved_txt!=EXT.saved_txt){txt=_hyperlink(txt);txt=txt.trim().nl2br();EXT.last_saved_txt=EXT.saved_txt;EXT.last_rendered_txt=txt;}return EXT.last_rendered_txt;};Photo_Note_EXT.prototype.start_dragging_resize=function(e,_106){var EL=this.EL;var EXT=this;e||(e=window.event);var ref="resize_"+_106+"_div";var _107=EXT[ref];EXT.papa.EXT.start_dragging_one();_disable_select();_107.lastClientX=e.clientX;_107.lastClientY=e.clientY;if(_106=="se"){var x=_pi(_107.style.left);var y=_pi(_107.style.top);var minX=e.clientX-x+EXT.resize_box_size;var maxX=minX+EXT.papa.EXT.get_image_w()-_pi(EL.style.left)-(EXT.resize_box_size*2)+1;var minY=e.clientY-y+EXT.resize_box_size;var maxY=minY+EXT.papa.EXT.get_image_h()-_pi(EL.style.top)-(EXT.resize_box_size*2)+1;}else{if(_106=="sw"){var x=_pi(EL.style.left);var y=_pi(_107.style.top);var minX=e.clientX-x+1;var maxX=minX+x+EXT.get_note_w()-(EXT.resize_box_size*2)-1;var minY=e.clientY-y+EXT.resize_box_size;var maxY=minY+EXT.papa.EXT.get_image_h()-_pi(EL.style.top)-(EXT.resize_box_size*2)+1;}else{if(_106=="nw"){var x=_pi(EL.style.left);var y=_pi(EL.style.top);var minX=e.clientX-x+1;var maxX=minX+x+EXT.get_note_w()-(EXT.resize_box_size*2)-1;var minY=e.clientY-y+1;var maxY=minY+y+EXT.get_note_h()-(EXT.resize_box_size*2)-1;}else{if(_106=="ne"){var x=_pi(_107.style.left);var y=_pi(EL.style.top);var minX=e.clientX-x+EXT.resize_box_size;var maxX=minX+EXT.papa.EXT.get_image_w()-_pi(EL.style.left)-(EXT.resize_box_size*2)+1;var minY=e.clientY-y+1;var maxY=minY+y+EXT.get_note_h()-(EXT.resize_box_size*2)-1;}}}}EXT.isDragging=1;EXT.change_display();document.dragee=_107;document.onmouseup=function(e){if(document.dragee){document.dragee.EL.EXT.stop_dragging_resize();}document.dragee=null;};document.onmousemove=function(e){e||(e=window.event);if(EXT.papa.EXT.hide_while_dragging){EXT.papa.EXT.hide_notes_text_div();}var ex=Math.min(Math.max(e.clientX,minX),maxX);var ey=Math.min(Math.max(e.clientY,minY),maxY);if(_106=="se"){var x=_pi(_107.style.left);var y=_pi(_107.style.top);var nx=x+(ex-_107.lastClientX);var ny=y+(ey-_107.lastClientY);_107.style.left=nx+"px";_107.style.top=ny+"px";EXT.innermost_div.style.width=(_pi(_107.style.left)+EXT.resize_box_size-4)+"px";EXT.innermost_div.style.height=(_pi(_107.style.top)+EXT.resize_box_size-4)+"px";EXT["resize_ne_div"].style.left=_107.style.left;EXT["resize_sw_div"].style.top=_107.style.top;}else{if(_106=="sw"){var x=_pi(EL.style.left);var y=_pi(_107.style.top);var nx=x+(ex-_107.lastClientX);var ny=y+(ey-_107.lastClientY);EL.style.left=nx+"px";_107.style.top=ny+"px";EXT.innermost_div.style.width=(_pi(EXT.innermost_div.style.width)+x-nx)+"px";EXT.innermost_div.style.height=(_pi(_107.style.top)+EXT.resize_box_size-4)+"px";EXT["resize_ne_div"].style.left=EXT["resize_se_div"].style.left=(_pi(EXT.innermost_div.style.width)-EXT.resize_box_size+4)+"px";EXT["resize_se_div"].style.top=_107.style.top;}else{if(_106=="nw"){var x=_pi(EL.style.left);var y=_pi(EL.style.top);var nx=x+(ex-_107.lastClientX);var ny=y+(ey-_107.lastClientY);EL.style.left=nx+"px";EL.style.top=ny+"px";EXT.innermost_div.style.width=(_pi(EXT.innermost_div.style.width)+x-nx)+"px";EXT.innermost_div.style.height=(_pi(EXT.innermost_div.style.height)+y-ny)+"px";EXT["resize_sw_div"].style.left=_107.style.left;EXT["resize_ne_div"].style.top=_107.style.top;EXT["resize_se_div"].style.top=EXT["resize_sw_div"].style.top=(_pi(EXT.innermost_div.style.height)-EXT.resize_box_size+4)+"px";EXT["resize_se_div"].style.left=EXT["resize_ne_div"].style.left=(_pi(EXT.innermost_div.style.width)-EXT.resize_box_size+4)+"px";}else{if(_106=="ne"){var x=_pi(_107.style.left);var y=_pi(EL.style.top);var nx=x+(ex-_107.lastClientX);var ny=y+(ey-_107.lastClientY);_107.style.left=nx+"px";EL.style.top=ny+"px";EXT.innermost_div.style.width=(_pi(_107.style.left)+EXT.resize_box_size-4)+"px";EXT.innermost_div.style.height=(_pi(EXT.innermost_div.style.height)+y-ny)+"px";EXT["resize_se_div"].style.left=_107.style.left;EXT["resize_se_div"].style.top=EXT["resize_sw_div"].style.top=(_pi(EXT.innermost_div.style.height)-EXT.resize_box_size+4)+"px";}}}}_107.lastClientX=ex;_107.lastClientY=ey;if(!EXT.papa.EXT.hide_while_dragging){EXT.papa.EXT.place_notes_text_div();}};};Photo_Note_EXT.prototype.stop_dragging_resize=function(){var EL=this.EL;var EXT=this;_enable_select();if(!EXT.isDragging){return;}document.onmousemove=null;EXT.papa.EXT.start_editing_one(EL);EXT.isDragging=0;EXT.change_display();};Photo_Note_EXT.prototype.show_resize_divs=function(){var EL=this.EL;var EXT=this;EXT.resize_nw_div.style.display=EXT.resize_ne_div.style.display=EXT.resize_sw_div.style.display=EXT.resize_se_div.style.display="block";};Photo_Note_EXT.prototype.hide_resize_divs=function(){var EL=this.EL;var EXT=this;EXT.resize_nw_div.style.display=EXT.resize_ne_div.style.display=EXT.resize_sw_div.style.display=EXT.resize_se_div.style.display="none";};Photo_Note_EXT.prototype.get_note_w=function(){var EL=this.EL;var EXT=this;return _pi(EXT.innermost_div.style.width)+4;};Photo_Note_EXT.prototype.get_note_h=function(){var EL=this.EL;var EXT=this;return _pi(EXT.innermost_div.style.height)+4;};Photo_Note_EXT.prototype.get_note_x=function(){var EL=this.EL;var EXT=this;return _pi(EL.style.left)-1;};Photo_Note_EXT.prototype.get_note_y=function(){var EL=this.EL;var EXT=this;return _pi(EL.style.top)-1;};Photo_Note_EXT.prototype.onmouseover=function(){var EL=this.parentNode;var EXT=EL.EXT;if(EXT.papa.EXT.editing||global_comm_div.comming||EXT.papa.EXT.dragging){return;}EXT.isOver=1;EXT.change_display();EXT.papa.EXT.start_showing_one(EL);};Photo_Note_EXT.prototype.onmouseout=function(){var EL=this.parentNode;var EXT=EL.EXT;if(EL.id=="photo_note_temp"){return;}EXT.hide_timmy=setTimeout("_ge('"+EL.id+"').EXT.take_another_little_piece_of_my_heart('Photo_Note_EXT.prototype.onmouseout');",200);};Photo_Note_EXT.prototype.take_another_little_piece_of_my_heart=function(){var EL=this.EL;var EXT=this;if(EXT.papa.EXT.editing||global_comm_div.comming||EXT.papa.EXT.dragging){return;}EXT.isOver=0;EXT.change_display();EXT.papa.EXT.stop_showing_one();};Photo_Note_EXT.prototype.start_editing=function(){var EL=this.EL;var EXT=this;if(EXT.editing){return;}EXT.isOver=1;EXT.editing=1;EXT.change_display();};Photo_Note_EXT.prototype.stop_editing=function(_114){var EL=this.EL;var EXT=this;EXT.editing=0;if(_114){EL.style.left=EXT.saved_x+"px";EL.style.top=EXT.saved_y+"px";EXT.innermost_div.style.width=EXT.saved_w+"px";EXT.innermost_div.style.height=EXT.saved_h+"px";EXT.resize_nw_div.style.top=EXT.resize_ne_div.style.top="0px";EXT.resize_sw_div.style.top=EXT.resize_se_div.style.top=(EXT.get_note_h()-EXT.resize_box_size)+"px";EXT.resize_nw_div.style.left=EXT.resize_sw_div.style.left="0px";EXT.resize_ne_div.style.left=EXT.resize_se_div.style.left=(EXT.get_note_w()-EXT.resize_box_size)+"px";EXT.papa.EXT.start_showing_one(EL);}EXT.change_display();};Photo_Note_EXT.prototype.onmousedown=function(e){var EL=this.parentNode;var EXT=EL.EXT;e||(e=window.event);if(!EXT.papa.EXT.editing&&!global_comm_div.comming&&!EXT.papa.EXT.dragging){EXT.start_editing();}if(((!EXT.papa.EXT.editing&&!EXT.papa.EXT.dragging)||EXT.papa.EXT.which_note==EL)&&!global_comm_div.comming){EXT.start_dragging(e);}};Photo_Note_EXT.prototype.stop_dragging=function(){var EL=this.EL;var EXT=this;_enable_select();if(!EXT.isDragging){return;}document.onmousemove=null;EXT.papa.EXT.start_editing_one(EL);EXT.isDragging=0;EXT.change_display();};Photo_Note_EXT.prototype.start_dragging=function(e){var EL=this.EL;var EXT=this;e||(e=window.event);EXT.papa.EXT.start_dragging_one();_disable_select();var x=_pi(EL.style.left);var y=_pi(EL.style.top);EL.lastClientX=e.clientX;EL.lastClientY=e.clientY;var minX=e.clientX-x+1;var maxX=minX+EXT.papa.EXT.get_image_w()-EXT.get_note_w();var minY=e.clientY-y+1;var maxY=minY+EXT.papa.EXT.get_image_h()-EXT.get_note_h();EXT.isDragging=1;EXT.change_display();document.dragee=EL;document.onmouseup=function(e){if(document.dragee){document.dragee.EXT.stop_dragging();}document.dragee=null;};document.onmousemove=function(e){e||(e=window.event);if(EXT.papa.EXT.hide_while_dragging){EXT.papa.EXT.hide_notes_text_div();}var x=_pi(EL.style.left);var y=_pi(EL.style.top);var ex=Math.min(Math.max(e.clientX,minX),maxX);var ey=Math.min(Math.max(e.clientY,minY),maxY);var nx=x+(ex-EL.lastClientX);var ny=y+(ey-EL.lastClientY);EL.style.left=nx+"px";EL.style.top=ny+"px";EL.lastClientX=ex;EL.lastClientY=ey;if(!EXT.papa.EXT.hide_while_dragging){EXT.papa.EXT.place_notes_text_div();}};};Photo_Note_EXT.prototype.refresh_info=function(_115,_116,_117,_118,_119,_120){var EL=this.EL;var EXT=this;EXT.note_id=_115;EL.id="photo_note_"+_115;EL.style.left=(_116+1)+"px";EL.style.top=(_117+1)+"px";EXT.innermost_div.style.width=(_118-4)+"px";EXT.innermost_div.style.height=(_119-4)+"px";EXT.saved_txt=_120;EXT.saved_x=_pi(EL.style.left);EXT.saved_y=_pi(EL.style.top);EXT.saved_w=_pi(EXT.innermost_div.style.width);EXT.saved_h=_pi(EXT.innermost_div.style.height);};Photo_Note_EXT.prototype.change_display=function(){var EL=this.EL;var EXT=this;EXT.box_div.childNodes[0].style.borderStyle="solid";EXT.box_div.childNodes[0].childNodes[0].style.borderStyle="solid";EXT.box_div.style.left=EXT.box_div.style.top="0px";EXT.box_div.style.borderWidth="0";EXT.hide_resize_divs();if(EXT.editing){EXT.show_resize_divs();EXT.box_div.childNodes[0].childNodes[0].style.borderStyle="dashed";EXT.box_div.childNodes[0].style.borderStyle="dashed";}else{if(EXT.isOver){EXT.box_div.style.left=EXT.box_div.style.top="-1px";EXT.box_div.style.borderWidth="1px";}else{}}};
